<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„äº‘ç«¯æ—¥è®° (å›½å†…æé€Ÿç‰ˆ)</title>
    <!-- å¼•å…¥ Bmob SDK (å›½å†…æºï¼Œé€Ÿåº¦å¿«) -->
 <script src="https://registry.npmmirror.com/bmob.js-sdk/2.2.0/files/dist/Bmob-2.2.0.min.js"></script>
    <style>
        /* æ ·å¼ä¿æŒä¸å˜ */
        :root { --primary-color: #ff6b6b; --secondary-color: #5563DE; --bg-color: #f4f7f6; --card-bg: #ffffff; --text-color: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); margin: 0; padding: 20px; min-height: 100vh; color: var(--text-color); }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 30px; }
        .editor-card { background: var(--card-bg); border-radius: 15px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 30px; }
        input[type="text"], input[type="date"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        #editor { width: 100%; min-height: 200px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-sizing: border-box; margin-bottom: 15px; overflow-y: auto; outline: none; }
        #editor img, .diary-content img { max-width: 100%; border-radius: 8px; margin: 10px 0; display: block; }
        .toolbar { display: flex; gap: 10px; margin-bottom: 15px; }
        button { border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        .btn-img { background-color: #e0e0e0; color: #333; }
        .btn-save { background-color: var(--secondary-color); color: white; flex-grow: 1; }
        #fileInput { display: none; }
        .diary-list { display: flex; flex-direction: column; gap: 20px; }
        .diary-entry { background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .diary-header { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .diary-date { color: #888; font-size: 0.9em; }
        .diary-title { margin: 0; font-size: 1.2em; color: var(--secondary-color); }
        .btn-delete { background-color: #ff4d4d; color: white; padding: 5px 10px; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“– æˆ‘ä»¬çš„æ—¥è®°æœ¬</h1>
        <p>æ— éœ€åŠ é€Ÿå™¨ Â· å›½å†…ç›´è¿</p>
    </header>

    <div class="editor-card">
        <input type="text" id="titleInput" placeholder="ä»Šå¤©çš„æ ‡é¢˜æ˜¯..." />
        <input type="date" id="dateInput" />
        <div class="toolbar">
            <button class="btn-img" onclick="document.getElementById('fileInput').click()">ğŸ“· æ’å…¥å›¾ç‰‡</button>
            <input type="file" id="fileInput" accept="image/*" onchange="handleImageUpload(event)">
        </div>
        <div id="editor" contenteditable="true"></div>
        <button class="btn-save" onclick="saveDiary()">ğŸ’¾ ä¿å­˜åˆ° Bmob</button>
    </div>

    <div id="diaryList" class="diary-list"></div>
</div>

<script>
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // â˜…â˜…â˜… è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ åœ¨ Bmob è·å–çš„ä¸¤ä¸ªå‚æ•° â˜…â˜…â˜…
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    
    // åˆå§‹åŒ– Bmob (æŠŠä½ çš„ Secret Key å’Œ API å®‰å…¨ç  å¡«åœ¨ä¸‹é¢)
    // æ³¨æ„ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Secret Keyï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ API å®‰å…¨ç 
    Bmob.initialize("b10c55bf8c2d800a", "6fbkq23ght69bsgf");

    // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('dateInput').valueAsDate = new Date();
        loadDiaries();
    });

    // å›¾ç‰‡å¤„ç†
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                document.getElementById('editor').appendChild(img);
                document.getElementById('editor').appendChild(document.createElement('br'));
            };
            reader.readAsDataURL(file);
        }
    }

    // 1. ä¿å­˜æ—¥è®°åˆ° Bmob
    function saveDiary() {
        const title = document.getElementById('titleInput').value;
        const date = document.getElementById('dateInput').value;
        const content = document.getElementById('editor').innerHTML;

        if (!title || !content.trim()) { alert("å†™ç‚¹ä¸œè¥¿å†ä¿å­˜å§ï¼"); return; }

        const query = Bmob.Query('Diary');
        query.set("title", title);
        query.set("date", date);
        query.set("content", content);
        
        const btn = document.querySelector('.btn-save');
        btn.innerText = 'æ­£åœ¨ä¿å­˜...';
        btn.disabled = true;

        query.save().then(res => {
            alert("ä¿å­˜æˆåŠŸï¼");
            document.getElementById('titleInput').value = '';
            document.getElementById('editor').innerHTML = '';
            loadDiaries();
            btn.innerText = 'ğŸ’¾ ä¿å­˜åˆ° Bmob';
            btn.disabled = false;
        }).catch(err => {
            console.log(err);
            alert("ä¿å­˜å¤±è´¥ï¼š" + JSON.stringify(err));
            btn.innerText = 'ğŸ’¾ ä¿å­˜åˆ° Bmob';
            btn.disabled = false;
        });
    }

    // 2. ä» Bmob åŠ è½½æ—¥è®°
    function loadDiaries() {
        const listContainer = document.getElementById('diaryList');
        listContainer.innerHTML = '<p style="text-align:center;">æ­£åœ¨åŠ è½½...</p>';

        const query = Bmob.Query("Diary");
        query.order("-createdAt"); // æŒ‰åˆ›å»ºæ—¶é—´å€’åº

        query.find().then(res => {
            listContainer.innerHTML = '';
            if (res.length === 0) {
                listContainer.innerHTML = '<p style="text-align:center; color:#888;">è¿˜æ²¡æœ‰æ—¥è®°ï¼Œå¿«å»å†™ä¸€ç¯‡å§ï¼</p>';
                return;
            }

            res.forEach(diary => {
                const card = document.createElement('div');
                card.className = 'diary-entry';
                card.innerHTML = `
                    <div class="diary-header">
                        <div>
                            <h3 class="diary-title">${diary.title}</h3>
                            <span class="diary-date">${diary.date}</span>
                        </div>
                        <button class="btn-delete" onclick="deleteDiary('${diary.objectId}')">åˆ é™¤</button>
                    </div>
                    <div class="diary-content">${diary.content}</div>
                `;
                listContainer.appendChild(card);
            });
        }).catch(err => {
            listContainer.innerHTML = '<p style="text-align:center; color:red;">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</p>';
        });
    }

    // 3. åˆ é™¤æ—¥è®°
    function deleteDiary(objectId) {
        if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡æ—¥è®°å—ï¼Ÿ")) {
            const query = Bmob.Query('Diary');
            query.destroy(objectId).then(res => {
                loadDiaries();
            }).catch(err => {
                alert("åˆ é™¤å¤±è´¥");
            });
        }
    }
</script>
</body>
</html>



